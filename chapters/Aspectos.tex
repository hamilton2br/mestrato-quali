% ----------------------------------------------------------
% Capitulo de Aspectos conceituais e economigos 
% ----------------------------------------------------------
\chapter{Fundamentação Teórica}
\label{chp:fundamentação}

Desde 2001, modelos de condução de investigação digital foram propostas. 
%
O \textit{Enhanced Digital Investigation Process Model} proposto por Carrier e Stafford em 2003 é a última iteração na evolução do processo forense digital.
%
Entretanto tais modelos de investigação foram desenvolvidos antes da aparição de tecnologias de computação em nuvem e partem do pressuposto que o investigador tem acesso e controle sobre o sistema sob investigação \cite{GrisposChallengesCloudComputing:2012}.
%
Esta defasagem esta no centro dos desafios da forense digital.

\section{Nuvem computacional}
\label{sec:computacaonuvem}

Uma nuvem computacional é um modelo de infraestrutura no qual recursos compartilhados em quantidade configurável, acessíveis via rede, são alocados e desalocados com esforço mínimo de gerenciamento por parte de um provedor de serviços.
%
Há três modelos principais de comercialização de uso da nuvem: \textit{software} como serviço (\textit{Software as a Service} -- SaaS), na qual se provê o \textit{software} que será usado pelo cliente; plataforma como serviço (\textit{Platform as a Service} -- PaaS), na qual se provê o ambiente para que o cliente desenvolva, teste e execute seu \textit{software}; e, o tipo mais pertinente para este trabalho, infraestrutura como serviço (\textit{Infrastructure as a Service} -- IaaS), na qual são fornecidos recursos computacionais básicos, como processamento e memória, em geral de forma virtualizada \cite{NIST2011}.

Uma arquitetura muito usada hoje nas soluções em nuvem são as auto-escaláveis onde recursos são altamente voláteis, sendo alocados e desalocados a qualquer momento. 
%
Tais arquiteturas possuem receitas para criação de máquinas adequadas a atividade fim do sistema que o orquestrador da nuvem segue no momento em que precisa criar máquinas para suprir um eventual aumento de demanda.
%
As receitas, escritas em linguagem específica, podem conter instruções de como distribuir o tráfego de rede entre as novas máquinas ou como redistribuir os dados na nova máquina de um banco de dados distribuídos
%
Estas implementações tem a vantagem de usar os recursos de nuvem de uma forma mais eficiente, menos necessidade de intervenção humana e são mais resilientes a variação na demanda do sistema.


\section{Uso de contêineres}
\label{sec:conteiner}

Segundo \cite{AmazonContainer}, contêiner é um método de virtualização do sistema operacional que permite executar uma aplicação e suas dependências em um processo com os recursos como disco, memória e rede isolados.
%
Diferente das máquinas virtuais, a virtualização com contêineres é feita no nível do SO nativo, tem uma implementação mais simples eliminado camadas entre o aplicativo executado e o \textit{hardware} físico permitindo maior granularidade no controle sobre esses recursos melhorando a eficiência da infraestrutura.
%
Uma tecnologia bastante utilizada para esse propósito são Contêineres Linux (LXC) \cite{Linuxcontainers.org2015}, que aproveitam-se de funcionalidades como \textit{cgroups}, \textit{kernel namespacing} e \textit{chroot} do kernel do Linux para auxiliar no gerenciamento e isolamento de recursos virtuais.

Control Groups (\textit{cgroups}) é uma funcionalidade do Kernel do Linux que limita e isola o uso de recursos como CPU, memória e disco de um conjunto de processos e os organiza de forma hierárquica. 
%
O trabalho nesta funcionalidade começou em 2006 na Google sob a denominação de \textit{process container}. No fim de 2007 seu nome mudou para \textit{control groups} e foi adicionado a versão 2.6.24 do kernel lançado em 2008 \cite{UnixManPagesControlGroups}.

\textit{Namespacing} é uma funcionalidade do Kernel do Linux usado para isolar e virtualizar recursos do sistema operacional como Ids de processos, acessos a rede, comunicação inter-processos e sistema de arquivos.
%
\textit{Namespacing} envolve os recursos do sistema operacional em uma abstração que faz parecer aos processos de um mesmo \textit{namespace} que eles tem sua própria instância isolada de um recurso global, é a principal funcionalidade por trás da implementação de contêineres \cite{UnixManPagesNamespacing}.

Change Root (\textit{chroot}) é uma funcionalidade do Kernel do Linux usado para mudar o diretório root do processo que está chamando a função e de todos os seus processos filhos. 
%
A chamada a \textit{chroot} altera o processo de resolução de caminhos do sistema operacional para o processo que o chamou \cite{UnixManPagesChRoot}.
%
Desta forma pode-se instalar uma distribuição Linux secundária em uma pasta, ao invés de uma partição, e executar programas desta pasta sem perda significativa de desempenho.

\section{Forense digital e seus desafios}
\label{sec:forensedigital}

Forense digital (também conhecida por forense computacional) é um conjunto de técnicas de coleta e análise da interação entre humanos e computadores de forma que esta seja aceita em um processo legal.
%
Tal como a forense tradicional, a forense digital se baseia no princípio de Locard. Definido pelo médico francês Edmond Locard, estabelece que ``Quando um indivíduo entra em contato com outro objeto ou indivíduo, este sempre deixa vestígio deste contato'' \cite{Ramos:2011}.
%
A forense digital tem por objetivo a investigação de evidências digitais da interação entre homem e máquina de modo a reconstruir a cadeia de eventos no passado de forma que suas conclusões sejam validadas por terceiros e sejam aceitas em um processo legal.


\subsection{Aceitabilidade da evidência em processo legal.}
\label{sec:credibilidadeaceitabilidadeevidencia}

O processo de análise forense no evento de um crime digital é descrito no EDIPM por 4 fases: Identificar, preservar, examinar e apresentar \cite{GrisposChallengesCloudComputing:2012}.
%
Pertinente a este trabalho, a fase de preservação da evidência deve ser conduzida de forma ``forensicamente aceitável'' isto é, coletar as evidências de forma que as mesmas sejam aceitas em um processo legal e não sejam invalidadas no curso do mesmo.
%

Para atingir tal objetivo o primeiro passo é a garantia da cadeia de custódia relacionada a evidência.
%
Cadeia de custódia é o processo de documentação da história cronológica da evidência de modo a saber onde a evidência esteve e quem teve acesso a ela \cite{Ramos:2011}. O SENASP 2013 define cadeia de custódia como ``a sistemática de procedimentos que visa à preservação do valor probatório da prova pericial caracterizada.''
%

O passo seguinte é a garantia da autenticidade e integridade da evidência.
%
Autenticidade, é descrito como ``o processo pelo qual se pode garantir a autoria do documento eletrônico'', ou seja, não permite dúvida quanto à identificação do autor.
%
Integridade, é descrita como ``o atestado da inteireza do documento eletrônico após sua transmissão, bem como apontar eventual alteração irregular de seu conteúdo''. \cite{Ramos:2011}
%
Caso haja dúvida a cerca de um destes requisitos, uma perícia técnica pode ser convocada, nesta será analisada o autor da evidência ou seja sua fonte e se a mesma não foi alterada no processo.


Em infraestrutura física esta coleta era relativamente simples, bastava-se remover o recurso físico, transportar este para um laboratório e lá analisar a evidência. A Evidência era mantida em uma sala-cofre onde o acesso era controlado.
%
A reprodutibilidade do processo de coleta e a manutenção da integridade da evidência eram tarefas bem diretas.
%
A computação em nuvem, especialmente as de infraestrutura auto-escalável trouxeram um conjunto de desafios novos. 
%
O recurso físico não pode mais ser removido pois o mesmo é utilizado por outros usuários não relacionados a investigação, fazê-lo constituiria violação de privacidade.
%
A volatilidade dos recursos tornou a verificação do seu autor um processo mais complexo pois o recurso que a gerou pode não existir mais \cite{SimouCloudChlng:2014}.
%
A integridade da evidência também tornou-se mais complexa pois ela precisa ser coletada, transportada e armazenada. O processo de cadeia de custódia ganhou grande visibilidade neste quesito.
%
Violação de qualquer uma das características citadas anteriormente põe em dúvida a credibilidade da evidência.

\subsection{Volume de dados para coleta}
\label{sec:volumedados}

O processo de coleta da evidência na forense digital herdou suas práticas da forense tradicional onde isola-se cena do crime e coletam-se as evidências presentes. 
%
Transportando para a forense digital introduziu-se a realização da cópia bit a bit da informação que se deseja analisar.
%
No passado, com as soluções manipulando quantidades bem menores de memória, disco e tráfego, tal prática não trazia problemas. Nas atuais soluções, aplicações e arquiteturas em nuvem, o volume de dados aumentou consideravelmente.
%
Em 2014 investigadores forenses tinham em média 6 meses de backlog para analisar \cite{QuickIncreaseVolumeImpact:2014}. 
%
Encontrar uma forma de armazenar menos informações de modo a tornar a fase de análise mais rápida e eficiente ajudará nas investigações.

\subsection{Privacidade e jurisdição}
\label{sec:violacaoprivacidadejuriscdicao}

Na metodologia tradicional de coleta de evidências para análise, isola-se o ambiente e as evidencias são removidas. Transportando para a forense digital, temos a prática de remover o equipamento para realização de cópia bit a bit da evidência.
%
Nas soluções de infra estrutura física esta prática não trás problemas, os objetos ou indivíduos sob investigação estão diretamente relacionados ao equipamento removido.
%
Nas soluções em nuvem esta prática não pode mais ser utilizada, pois como o recurso físico é compartilhado por vários usuários não envolvidos na investigação, removê-los configura violação de privacidade.
%
Um complicador a mais é o fato de os dados não estarem armazenados no mesmo território em que a investigação é realizada demandando acordos de cooperação jurídica entre as partes o que nem sempre é possível \cite{SimouCloudChlng:2014}.
%
Neste cenário encontrar uma forma de coletar a evidência sem violar jurisdição e privacidade são de grande importância num futuro próximo.


\subsection{Coleta de evidências de memória volátil de máquinas em nuvem}
\label{sec:forensenuvem}

A prática de armazenar histórico de tráfego de rede e alterações de dados armazenados em disco já é bem difundida na comunidade.
%
Memória volátil porém não tem o mesmo tratamento sendo suas alterações quase nunca são armazenadas, seja por questões de performance ou por praticidade dado a alta volatilidade.
%
Existe uma classe específica de ataques conhecidos como injeção de código em memória \cite{CaseMemoryForensics:2014}. Tais ataques quando usados contra uma arquitetura em nuvem, não deixam rastros quando recursos de processamento virtuais são desativados e sua memória é liberada \cite{VomelMemoryAcquisition:2013}, \cite{CaseMemoryForensics:2014}.
%
Em particular, têm especial interesse quatro tipos específicos dessa família de ameaças \cite{CaseMemoryForensics:2014}:


\begin{itemize}
 \item \textbf{Injeção remota de bibliotecas}: Um processo malicioso força o processo alvo a carregar uma biblioteca em seu espaço de memória.
 %
 Como resultado, o código da biblioteca carregada executa com os mesmos privilégios do executável em que ela foi injetada. 
 %
 Esta estratégia, comumente usada para instalar malwares, pode fazer com que uma biblioteca maliciosa armazenada no sistema seja distribuída por vários processos de uma mesma máquina, dificultando sua remoção \cite{MillerRemoteLibraryInjection:2004}.
 %
 \item \textbf{Inline Hooking}: Um processo malicioso escreve código como uma sequência de bytes diretamente no espaço de memória de um processo alvo, e então força este último a executar o código injetado. 
 %
 O código pode ser, por exemplo, um \textit{script} de \textit{shell}.
 %
 \item \textbf{Injeção reflexiva de biblioteca}: Um processo malicioso acessa diretamente a memória do processo alvo, inserindo nela o código de uma biblioteca na forma de uma sequência de bytes, e então força o processo a executar essa biblioteca. 
 %
 Nessa forma de ataque, a biblioteca maliciosa não existe fisicamente; isso torna tal estratégia de injeção de código potencialmente mais atrativa, pois o carregamento da biblioteca não é registrado no sistema operacional (SO), dificultando a detecção do ataque \cite{FewerReflectiveLibraryInject:2008}.
 %
 \item \textbf{Injeção de processo vazio}: Um processo malicioso dispara uma instância de um processo legítimo no estado ``suspenso''; a área do executável é então liberada e realocada com código malicioso.
\end{itemize}





